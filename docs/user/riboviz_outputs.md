# riboviz output files and figures

This document lists the output files from a typical riboviz run, along with short descriptions.

After a riboviz run, many output files are produced within the output directory.
The output directory is specified by the parameter `dir_out` in `config.yaml`.

There are a few output files that collect information for an entire run.
There are many output files that are specific to each sample, which are organized into a separate subdirectory for each sample. 


# Output files for an entire run


## `TPMs_collated.tsv` 

File with the transcripts per million (tpm) for all successfully processed samples. Generated by collate_TPMs.R
```
ORF	wt.noAT.ribo.3_s	wt.AT.ribo.3_s	wt.noAT.ribo.4_s	wt.AT.ribo.4_s
SPAC1002.01.1	16.5	25.7	20.8	20
SPAC1002.02.1	37.7	43.1	44.2	55.8
SPAC1002.03c.1	80.9	83.9	73.5	89.6
SPAC1002.04c.1	58.5	77.8	60.1	79.1
SPAC1002.05c.1	5.2	9.1	6.4	9.2
SPAC1002.06c.1	3.6	4	1.7	2.9
```

## `read_counts.tsv` 

A [read counts file](#read-counts-file) (only if `count_reads: TRUE`). Produced by count_reads.py 

SampleName	Program	File	NumReads	Description
30C1	input	/exports/csce/eddie/biology/groups/wallace_rna/riboviz-emma/riboviz/riboviz/M-Ec_2018/input/SRR5036070.fastq.gz	17874120	input
30C1	cutadapt	/exports/csce/eddie/biology/groups/wallace_rna/riboviz-emma/riboviz/riboviz/M-Ec_2018/tmp/30C1/trim.fq	17791329	Reads after removal of sequencing library adapters
30C1	hisat2	/exports/csce/eddie/biology/groups/wallace_rna/riboviz-emma/riboviz/riboviz/M-Ec_2018/tmp/30C1/nonrRNA.fq	13335859	rRNA or other contaminating reads removed by alignment to rRNA index files


# Output files for each sample

For each sample (`<SAMPLE_ID>`), intermediate files are produced in a sample-specific subdirectory (`<SAMPLE_ID>`).


## `<SAMPLE_ID>_output_report.html` 

This output report in .html format contains a provenance section for the sample run, all of the pdfs produced, and a information on any plots not produced multiple figures output by riboviz:

* first figure (link to description below?)
* ... (fill this in!)

Only output if `run_static_html: TRUE`. Produced by AnalysisOutputs.Rmd.


## `<SAMPLE_ID>.bam` 

BAM file of reads mapped to transcripts, which can be directly used in genome browsers. Created during the step 


## `<SAMPLE_ID>.bam.bai` 

BAM index file for `<SAMPLE_ID>.bam`.


## `minus.bedgraph` 

Bedgraph of reads from minus strand (if `make_bedgraph: TRUE`).

Because riboviz aligns to the transcriptome, which represents single-stranded positive-sense RNA, there should be very few reads counted in `minus.bedgraph`.


## `plus.bedgraph` 

Bedgraph of reads from plus strand (if `make_bedgraph: TRUE`).

Almost all translated reads should be counted in open reading frames within `plus.bedgraph`, again because riboviz aligns to the transcriptome, which represents single-stranded positive-sense RNA.


## `<SAMPLE_ID>.h5` 

Length-sensitive alignments in compressed h5 format. Created from the sample Bam file using Bam_to_H5. Using GetGeneDataMatrix(), then TidyGeneDataMatrix() in R will create a tibble showing the number of reads of each length occurring at each position in a gene. Other functions useful for working with a h5 file are outlined in rscript/read_count_functions.R

## `3nt_periodicity.tsv`

A tsv file, showing the sum of reads (Counts) occurring at positions around the start codon for all genes. Generated by generate_stats_figs.R during step “Check for 3nt periodicity globally”, using function WriteThreeNucleotidePeriodicity. 

```
Pos	Counts	End
-24	638	5'
-23	862	5'
-22	890	5'
-21	775	5'
-20	1067	5'
-19	1531	5'
-18	1077	5'
```

## `3nt_periodicity.pdf`

A Meta Feature plot showing the total number of reads present within 50nt of the start and stop codons. The reads occurring at each position for each gene are summed to give a total for each position, then plotted. It is expected to see a large peak just upstream of the start codon, due to ribosome binding being the slow step of translation, the regular repeating smaller peaks, showing 3nt periodicity, as the majority of reads will map to the first nucleotide of a codon. If the expected features are not seen, then it is possible that there is a problem with annotation files, the adapter listed in the config files or the dataset used is of low quality. 

## `read_lengths.tsv`

A tsv file showing how many reads are of each length, with the majority being of 28-31 nt in length. Generated by generate_stats_figs.R during step “Distribution of lengths of all mapped reads” using function WriteReadLengths. 

```
Length	Counts
10	0
11	0
12	0
13	0
14	0
15	841
16	1655
```
## `read_lengths.pdf`

A bar chart showing the lengths of the reads detected in the sample. It is expected that the majority of reads will be 28-31 nt long. A good file to check first when running a new dataset, as if the reads peak in the expected range then it is a good indication of a successful run. If no reads are detected then it is a clear indication of something going wrong, potentially the wrong UMI expression or adapter sequence being used, leading to reads being unable to align to annotation files.

## `pos_sp_nt_freq.tsv`

A tsv file listing the frequency of each different nucleotide at each position of reads of different lengths, including all three possible frames for each read length. Generated by generate_stats_figs.R during step “Biases in nucleotide composition along mapped read lengths” using function WriteBiasesInNucleotideComposition.
```
Length	Position	Frame	A	C	G	T
10	1	0	0	0	0	0
10	2	0	0	0	0	0
10	3	0	0	0	0	0
10	4	0	0	0	0	0
10	5	0	0	0	0	0
10	6	0	0	0	0	0
```

## `pos_sp_rpf_norm_reads.pdf`

A pdf that shows the mean number of reads mapping to each position upstream and downstream of the start and stop codon for all genes. It is expected to have a peak at the start codon, with the majority of following positions having a relatively consistent mean. 

## `pos_sp_rpf_norm_reads.tsv`

A tsv file listing the mean and standard deviation of number of reads detected at positions along genes. The positions are from 1 to 500 nt downstream of the start codon and -500 to -1 nt upstream of the stop codon. Generated by generate_stats_figs.R during step “Position specific distribution of reads” using function WritePositionSpecificDistributionOfReads

```
Position	Mean	SD	End
1	3.13047048466068	0.225956422004294	5'
2	1.79702548620289	0.113342824868913	5'
3	0.709121883164236	0.0516397410730882	5'
4	1.05738021362083	0.0737353413990959	5'
5	1.01560588202852	0.0589736885646061	5'
6	1.68451606445801	0.0801004577589218	5'
```
## `features.pdf` 

Only output if `--features-file` was defined.


## `tpms.tsv`

A tsv file listing the rpb (reads per base) and tpm (transcripts per million) of the ORFs of a sample. Generated by generate_stats_figs.R during step “Calculate TPMs of genes” using function WriteGeneTranscriptsPerMillion.

```
ORF	readcount	rpb	tpm
NP_414542.1	974	8.61946902654867	843.13623482169
NP_414543.1	11839	4.71673306772908	461.379760996302
NP_414544.1	2188	2.23265306122449	218.392883587828
NP_414545.1	6085	4.56146926536732	446.192220171666
NP_414546.1	39	0.113372093023256	11.0897921149276
NP_414547.1	576	0.699029126213592	68.3773888729219
```
## `codon_ribodens.tsv` 

Only output if `--t-rna-file` and `--codon-positions-file` were defined.


## `codon_ribodens.pdf` 

Only output if `--t-rna-file` and `--codon-positions-file` were defined.


## `startcodon_ribogridbar.pdf`

A meta feature bar chart showing the number of reads occurring at positions around the start codons of genes, faceted by read length. As the majority of reads will be 28-31 nt in length, only bar charts for lengths 26-32 nt are shown. It is expected that each length will show a peak of reads just upstream of the start codon for all lengths, and then an observable 3nt periodicity following the peak, which will be more distinct in the more common read lengths. Note: the Y axis scale will vary for each read length. 

## `startcodon_ribogrid.pdf`

A meta feature density plot showing the number of reads occurring at positions around the start codons of genes with the y axis as read length, and the colour intensity showing read count. It is expected that each length will show a peak of reads just upstream of the start codon for all lengths, shown by an intense dark purple, and then an observable 3nt periodicity following the peak, which will be more distinct in the more common read lengths. 

## `3ntframe_bygene.tsv` 

A tsv file showing the count threshold for each frame and the p value comparing the counts in frame 0 to frames 1, 2 and both 1 and 2 for each gene. It is expected that there will be a significant difference between the frames, with the majority of reads mapping to frame 0. Generated by generate_stats_figs.R during step “Check for 3nt periodicity (frame) by Gene” using function WriteGeneReadFrames.
```
gene	Ct_fr0	Ct_fr1	Ct_fr2	pval_fr0vs1	pval_fr0vs2	pval_fr0vsboth
NP_414542.1	458	188	209	0.187869019813674	0.559363912058572	0.301278359648356
NP_414543.1	5059	3336	3175	1.04669876823157e-14	1.53879225424055e-08	5.76869029040149e-21
NP_414544.1	955	500	642	9.12272168024827e-06	0.00915956834347222	1.3114489332715e-06
NP_414545.1	2938	1275	1846	2.10406514936706e-11	0.00013967296062447	2.34640137852663e-13
NP_414546.1	22	6	9	0.00765130800767791	0.0435915158233007	0.00172615800773334
NP_414547.1	259	136	178	0.00052254320437398	0.0426319779860494	0.000204006580690583
```

Only output if `--asite-disp-length-file` was defined.

## `3ntframe_propbygene.pdf` 

Only output if `--asite-disp-length-file` was defined.

A box plot of the proportion of reads mapping to each nucleotide of a codon for each ORF, with the first codon being denoted as Frame 0, the second being Frame 1 and the 3rd being Frame 2. It is expected that the majority of reads will be mapping to the first nucleotide, Frame 0, so this box will be higher than the others. 
