# riboviz output files and figures

This document lists the output files from a typical riboviz run, along with short descriptions.

After a riboviz run, many output files are produced within the output directory.
The output directory is specified by the parameter `dir_out` in `config.yaml`.

There are a few output files that collect information for an entire run.
There are many output files that are specific to each sample, which are organized into a separate subdirectory for each sample. 


# Output files for an entire run


## `TPMs_collated.tsv` 

File with the transcripts per million (tpm) for all successfully processed samples. Generated by collate_TPMs.R

```
ORF	ANAPH_1	VEG_1
Q0045	54.5	0.7
Q0050	0.6	0.7
Q0055	0.6	0.1
Q0060	2.2	0.1
Q0065	22.2	1
Q0070	22.8	0.7
```

*Potential file names*

TPMs_all_samples, TPMs_samples_collated, TPMs_genes_collated, TPMs_samples_genes_compared, TPMs_all_genes_all_samples

## `read_counts.tsv` 

A [read counts file](#read-counts-file) (only if `count_reads: TRUE`). Produced by count_reads.py

This file lists the sample being processed, the stage of the riboviz process and file used at that stage, the number of reads at each stage and includes a description of the process. The number of reads is expected to decrease between stages as reads are filtered and trimmed.

```
SampleName	Program	File	NumReads	Description
VEG_1	input	/exports/csce/eddie/biology/groups/wallace_rna/riboviz-emma/riboviz/riboviz/B-Sc_2012/input/SRR387871.fastq.gz	21155927	input
ANAPH_1	input	/exports/csce/eddie/biology/groups/wallace_rna/riboviz-emma/riboviz/riboviz/B-Sc_2012/input/SRR387890.fastq.gz	10210064	input
ANAPH_1	cutadapt	/exports/csce/eddie/biology/groups/wallace_rna/riboviz-emma/riboviz/riboviz/B-Sc_2012/tmp/ANAPH_1/trim.fq	9458608	Reads after removal of sequencing library adapters
ANAPH_1	hisat2	/exports/csce/eddie/biology/groups/wallace_rna/riboviz-emma/riboviz/riboviz/B-Sc_2012/tmp/ANAPH_1/nonrRNA.fq	5999936	rRNA or other contaminating reads removed by alignment to rRNA index files
```

*Potential file names*

reads_per_process, reads_per_stage, reads_stage_inputs

# Output files for each sample

For each sample (`<SAMPLE_ID>`), intermediate files are produced in a sample-specific subdirectory (`<SAMPLE_ID>`).


## `<SAMPLE_ID>_output_report.html` 

This output report in .html format contains a provenance section for the sample run, all of the pdfs produced, and information on any plots not produced multiple figures output by riboviz:

* first figure (link to description below?)
* ... (fill this in!)

Only output if `run_static_html: TRUE`. Produced by AnalysisOutputs.Rmd.


## `<SAMPLE_ID>.bam` 

BAM file of reads mapped to transcripts, which can be directly used in genome browsers. The BAM file is produced by samtools.


## `<SAMPLE_ID>.bam.bai` 

BAM index file for `<SAMPLE_ID>.bam`. This file is produced by samtools.


## `minus.bedgraph` 

Bedgraph of reads from minus strand (if `make_bedgraph: TRUE`).

Because riboviz aligns to the transcriptome, which represents single-stranded positive-sense RNA, there should be very few reads counted in `minus.bedgraph`. This file is produced by bedtools.


## `plus.bedgraph` 

Bedgraph of reads from plus strand (if `make_bedgraph: TRUE`).

Almost all translated reads should be counted in open reading frames within `plus.bedgraph`, again because riboviz aligns to the transcriptome, which represents single-stranded positive-sense RNA. This file is produced by bedtools.


## `<SAMPLE_ID>.h5` 

Length-sensitive alignments in compressed h5 format. Created from the sample Bam file using Bam_to_H5. Using GetGeneDataMatrix(), then TidyGeneDataMatrix() in R will create a tibble showing the number of reads of each length occurring at each position in a gene. Other functions useful for working with a h5 file are outlined in rscript/read_count_functions.R

## `3nt_periodicity.tsv`

A tsv file, showing the sum of reads (Counts) occurring at positions around the start codon for all genes. Generated by generate_stats_figs.R during step “Check for 3nt periodicity globally”, using function WriteThreeNucleotidePeriodicity. 

```
Pos	Counts	End
-24	536	5'
-23	426	5'
-22	391	5'
-21	428	5'
-20	398	5'
-19	569	5'
```

*Potential names*

meta_read_counts_start_stop, meta_reads_start_stop, all_reads_meta_transcript, reads_meta_feature_transcript

## `3nt_periodicity.pdf`

A Meta Feature plot showing the total number of reads present within 50nt of the start and stop codons. The reads occurring at each position for each gene are summed to give a total for each position, then plotted. It is expected to see a large peak just upstream of the start codon, due to ribosome binding being the slow step of translation, the regular repeating smaller peaks, showing 3nt periodicity, as the majority of reads will map to the first nucleotide of a codon. If the expected features are not seen, then it is possible that there is a problem with annotation files, the adapter listed in the config files or the dataset used is of low quality. 

Good quality 3nt periodicity plot:

<img src="https://github.com/3mma-mack/Riboviz-honours/blob/main/riboviz_images/3nt_periodicity.jpg" alt="Good quality 3nt_periodicity plot" width="500"/>

3nt periodicity plot produced using incorrect annotation files:

<img src="https://github.com/3mma-mack/Riboviz-honours/blob/main/riboviz_images/bad_3nt_periodicity.jpg" alt="poor quality 3nt_periodicity plot" width="500"/>


*Potential names*

meta_read_counts_start_stop, meta_reads_start_stop, all_reads_meta_transcript, reads_meta_feature_transcript

## `read_lengths.tsv`

A tsv file showing how many reads are of each length, with the majority being of 28-31 nt in length. Generated by generate_stats_figs.R during step “Distribution of lengths of all mapped reads” using function WriteReadLengths. 

```
Length	Counts
10	0
11	0
12	0
13	0
14	0
15	21567
16	42981
```

## `read_lengths.pdf`

A bar chart showing the lengths of the reads detected in the sample. It is expected that the majority of reads will be 28-31 nt long. A good file to check first when running a new dataset, as if the reads peak in the expected range then it is a good indication of a successful run. If no reads are detected then it is a clear indication of something going wrong, potentially the wrong UMI expression or adapter sequence being used, leading to reads being unable to align to annotation files.

Example read_lengths plot:

<img src="https://github.com/3mma-mack/Riboviz-honours/blob/main/riboviz_images/read_lengths.jpg" alt="poor quality read_lengths plot" width="500"/>


## `pos_sp_nt_freq.tsv`

A tsv file listing the frequency of each different nucleotide at each position of reads of different lengths, including all three possible frames for each read length. Generated by generate_stats_figs.R during step “Biases in nucleotide composition along mapped read lengths” using function WriteBiasesInNucleotideComposition.

```
Length	Position	Frame	A	C	G	T
10	1	0	0	0	0	0
10	2	0	0	0	0	0
10	3	0	0	0	0	0
10	4	0	0	0	0	0
10	5	0	0	0	0	0
10	6	0	0	0	0	0
```

*Potential names*

read_nt_compostion, nt_freq_read_length, read_nt_freq

## `pos_sp_rpf_norm_reads.pdf`

A pdf that shows the mean number of reads mapping to each position upstream and downstream of the start and stop codon for all genes. It is expected to have a peak at the start codon, with the majority of following positions having a relatively consistent mean. 

Example pos_sp_rpf_norm_reads plot:

<img src="https://github.com/3mma-mack/Riboviz-honours/blob/main/riboviz_images/pos_sp_rpf_norm_reads.jpg" alt="pos_sp_rpf_norm_reads plot" width="500"/>

*Potential names*

norm_reads_transcript, norm_reads_start_stop

## `pos_sp_rpf_norm_reads.tsv`

A tsv file listing the mean and standard deviation of number of reads detected at positions along genes. The positions are from 1 to 500 nt downstream of the start codon and -500 to -1 nt upstream of the stop codon. Generated by generate_stats_figs.R during step “Position specific distribution of reads” using function WritePositionSpecificDistributionOfReads

```
Position	Mean	SD	End
1	12.0663784989888	0.395152590437387	5'
2	18.9618100010075	0.574744617743691	5'
3	3.0604586928262		0.130589596966622	5'
4	3.48406026456054	0.131466878328202	5'
5	3.34745502397165	0.160793140986733	5'
6	4.25230808548701	0.146130009657467	5'
```

*Potential names*

norm_reads_transcript, norm_reads_start_stop

## `features.pdf` 

Only output if `--features-file` was defined.

Example features plot:

<img src="https://github.com/3mma-mack/Riboviz-honours/blob/main/riboviz_images/features.jpg" alt=" features plot" width="500"/>

## `tpms.tsv`

A tsv file listing the rpb (reads per base) and tpm (transcripts per million) of the ORFs of a sample. Generated by generate_stats_figs.R during step “Calculate TPMs of genes” using function WriteGeneTranscriptsPerMillion.

```
ORF	readcount	rpb	tpm
Q0045	17	0.0102905569007264	0.665266152991222
Q0050	28	0.0109717868338558	0.709306453364419
Q0055	6	0.00229709035222052	0.148502794983537
Q0060	3	0.00231660231660232	0.1497642086861
Q0065	26	0.0151338766006985	0.97837813474214
Q0070	20	0.0103092783505155	0.66647646133505
```

*Potential names*

<SAMPLE_ID>_tmps

## `codon_ribodens.tsv` 

```
AA	Codon	tRNA	tAI	Microarray	RNA.seq	A	P	E
K	AAA	7	0.431034	222273	82386	0.701009246604793	0.757271500717756	0.882163216975167
N	AAC	10	0.615764	378101	110849	0.608843172114343	0.868064826175943	0.844584176727076
K	AAG	14	1	397111	83036	0.719699425589095	0.985491091356775	1.11948381450794
N	AAT	6.4	0.27032	241984.64	70943.36	0.566975111040301	0.786255203154437	0.76039088714112
T	ACA	4	0.246373	105862	47598	0.933640392583143	1.007034200634	1.11922337626619
```

Only output if `--t-rna-file` and `--codon-positions-file` were defined.


## `codon_ribodens.pdf` 

Example codon_ribodens plot:

<img src="https://github.com/3mma-mack/Riboviz-honours/blob/main/riboviz_images/codon_ribodens.jpg" alt="codon_ribodens plot" width="500"/>

Only output if `--t-rna-file` and `--codon-positions-file` were defined.


## `startcodon_ribogridbar.pdf`

A meta feature bar chart showing the number of reads occurring at positions around the start codons of genes, faceted by read length. As the majority of reads will be 28-31 nt in length, only bar charts for lengths 26-32 nt are shown. It is expected that each length will show a peak of reads just upstream of the start codon for all lengths, and then an observable 3nt periodicity following the peak, which will be more distinct in the more common read lengths. Note: the Y axis scale will vary for each read length. 

Example startcodon_ribogridbar:

<img src="https://github.com/3mma-mack/Riboviz-honours/blob/main/riboviz_images/startcodon_ribogridbar.jpg" alt="startcodon_ribogridbar plot" width="500"/>

*Potential names*

startcodon_gridbar, start_gridbar_readlen, readlen_gridbar_start

## `startcodon_ribogrid.pdf`

A meta feature heatmap showing the number of reads occurring at positions around the start codons of genes with the y axis as read length, and the colour intensity showing read count. It is expected that each length will show a peak of reads just upstream of the start codon for all lengths, shown by an intense dark purple, and then an observable 3nt periodicity following the peak, which will be more distinct in the more common read lengths. 

Example startcodon_ribogrid:

<img src="https://github.com/3mma-mack/Riboviz-honours/blob/main/riboviz_images/startcodon_ribogrid.jpg" alt="startcodon_ribogrid plot" width="500"/>

*Potential names*

startcodon_readlen_heatmap, heatmap_readlen_pos

## `3ntframe_bygene.tsv` 

A tsv file showing the count threshold for each frame and the p value comparing the counts in frame 0 to frames 1, 2 and both 1 and 2 for each gene. It is expected that there will be a significant difference between the frames, with the majority of reads mapping to frame 0. Generated by generate_stats_figs.R during step “Check for 3nt periodicity (frame) by Gene” using function WriteGeneReadFrames.

```
gene	Ct_fr0	Ct_fr1	Ct_fr2	pval_fr0vs1	pval_fr0vs2	pval_fr0vsboth
YAL068C	0	0	0	1	1	1
YAL067W-A	0	0	0	1	1	1
YAL067C	1	0	0	0.5	0.5	0.5
YAL065C	65	10	56	0.000225406271329839	0.433008955500838	0.00465962908671896
YAL064W-B	0	0	0	1	1	1
YAL064C-A	0	0	0	1	1	1
```

Only output if `--asite-disp-length-file` was defined.

## `3ntframe_propbygene.pdf` 

A box plot of the proportion of reads mapping to each nucleotide of a codon for each ORF, with the first codon being denoted as Frame 0, the second being Frame 1 and the 3rd being Frame 2. It is expected that the majority of reads will be mapping to the first nucleotide, Frame 0, so this box will be higher than the others. 

Example 3ntframe_propbygene:

<img src="https://github.com/3mma-mack/Riboviz-honours/blob/main/riboviz_images/3ntframe_propbygene.jpg" alt="3ntframe_propbygene plot" width="500"/>

Only output if `--asite-disp-length-file` was defined.
